<div class="habits-view" role="region" aria-label="Habits tracking view">
    <!-- Header with Month/Year Selector -->
    <div class="view-header">
        <div class="month-year-selector" role="group" aria-label="Month navigation">
            <button id="habits-prev-month-btn" class="nav-btn" aria-label="Go to previous month">
                <span aria-hidden="true">â†</span>
            </button>
            <h2 id="habits-current-month-year" aria-live="polite">January 2025</h2>
            <button id="habits-next-month-btn" class="nav-btn" aria-label="Go to next month">
                <span aria-hidden="true">â†’</span>
            </button>
            <button id="habits-today-btn" class="btn-today" aria-label="Go to current month"
                data-tooltip="Press T">Today</button>
        </div>
        <!-- Points Display -->
        <div class="points-display" aria-label="Your points">
            <span class="points-icon">â­</span>
            <span class="points-value" id="total-points">0</span>
            <span class="points-label">XP</span>
        </div>
    </div>

    <!-- Tab Switcher -->
    <div class="tabs" role="tablist" aria-label="Habit tracking options">
        <button class="tab-btn active" data-tab="daily-habits" role="tab" aria-selected="true"
            aria-controls="daily-habits-tab" id="daily-habits-tab-btn">Daily Habits</button>
        <button class="tab-btn" data-tab="weekly-habits" role="tab" aria-selected="false"
            aria-controls="weekly-habits-tab" id="weekly-habits-tab-btn">Weekly Habits</button>
        <button class="tab-btn" data-tab="challenges" role="tab" aria-selected="false" aria-controls="challenges-tab"
            id="challenges-tab-btn">Interval Challenges</button>
        <button class="tab-btn" data-tab="wellness" role="tab" aria-selected="false" aria-controls="wellness-tab"
            id="wellness-tab-btn">Wellness Trackers</button>
    </div>

    <!-- Daily Habits Tab -->
    <div id="daily-habits-tab" class="tab-content active" role="tabpanel" aria-labelledby="daily-habits-tab-btn">
        <div class="habits-container">
            <section class="habits-sidebar" aria-labelledby="daily-habits-heading">
                <h3 id="daily-habits-heading">Daily Habits (30 max)</h3>
                <div class="habits-filter">
                    <select id="daily-habits-filter" class="habits-filter-select" aria-label="Filter habits">
                        <option value="all">All Habits</option>
                        <option value="completed">Completed Today</option>
                        <option value="incomplete">Incomplete Today</option>
                        <option value="streak">Has Streak</option>
                    </select>
                    <div class="grid-mode-toggle" id="daily-grid-mode-toggle">
                        <button class="toggle-btn active" data-mode="checklist" title="Checklist View">âœ…</button>
                        <button class="toggle-btn" data-mode="count" title="Count/Note View">ğŸ”¢</button>
                    </div>
                </div>
                <div id="daily-habits-list" class="habits-list" role="list" aria-label="Daily habits list">
                    <!-- Habit names will be added here -->
                </div>
                <div class="habit-buttons">
                    <button id="add-daily-habit-btn" class="btn-secondary" aria-label="Add new daily habit">+ Add
                        Habit</button>
                    <button id="habit-bundles-btn" class="btn-icon" aria-label="Add habit bundle"
                        title="Quick-start bundles">ğŸ“¦</button>
                </div>
            </section>

            <div class="habits-grid-container">
                <div id="daily-habits-grid" class="habits-grid" role="grid" aria-label="Daily habits tracking grid">
                    <!-- Grid will be generated dynamically -->
                </div>

                <!-- Habit Tracking Chart -->
                <div class="habit-chart-container">
                    <div class="habit-chart-header">
                        <h4>ğŸ“Š Habit Tracking Chart</h4>
                        <select id="habit-chart-select" class="habit-chart-select" aria-label="Select habit to chart">
                            <option value="">Select a habit...</option>
                        </select>
                    </div>
                    <div class="habit-chart-info">
                        <span class="info-text">ğŸ’¡ Double-click habit cells to add count values (e.g., pages read).
                            Checked habits without notes count as 1.</span>
                    </div>
                    <div class="habit-line-chart" id="habit-line-chart">
                        <svg id="habit-chart-svg" class="habit-chart-svg" viewBox="0 0 600 150"
                            preserveAspectRatio="none">
                            <!-- Grid lines -->
                            <g class="chart-grid" id="chart-grid"></g>
                            <!-- Area fill -->
                            <path class="chart-area" id="chart-area"></path>
                            <!-- Line -->
                            <path class="chart-line" id="chart-line"></path>
                            <!-- Data points -->
                            <g class="chart-points" id="chart-points"></g>
                        </svg>
                        <div class="chart-y-axis" id="chart-y-axis"></div>
                        <div class="chart-x-axis" id="chart-x-axis"></div>
                    </div>
                    <div class="habit-chart-stats" id="habit-chart-stats">
                        <span class="stat-item"><strong>Total:</strong> <span id="habit-stat-total">0</span></span>
                        <span class="stat-item"><strong>Avg:</strong> <span id="habit-stat-avg">0</span>/day</span>
                        <span class="stat-item"><strong>Max:</strong> <span id="habit-stat-max">0</span></span>
                        <span class="stat-item"><strong>Days:</strong> <span id="habit-stat-days">0</span></span>
                    </div>
                </div>
            </div>

            <aside class="habits-progress" aria-labelledby="daily-progress-heading">
                <h3 id="daily-progress-heading">Monthly Progress</h3>
                <div id="daily-progress-list" class="progress-list">
                    <!-- Progress items will be added here dynamically -->
                </div>

                <!-- Streak Trend Chart -->
                <div class="streak-chart-section">
                    <h4>Streak Trends (Last 30 Days)</h4>
                    <div id="streak-chart" class="streak-chart">
                        <!-- Chart will be generated dynamically -->
                    </div>
                    <div class="streak-chart-legend">
                        <span class="legend-item"><span class="legend-color high"></span> 80%+</span>
                        <span class="legend-item"><span class="legend-color medium"></span> 50-79%</span>
                        <span class="legend-item"><span class="legend-color low"></span> &lt;50%</span>
                    </div>
                </div>

                <!-- Achievement Badges -->
                <div class="achievements-section">
                    <h4>ğŸ† Achievements</h4>
                    <div id="achievements-grid" class="achievements-grid">
                        <!-- Badges will be generated dynamically -->
                    </div>
                </div>

                <!-- Daily Challenge -->
                <div class="daily-challenge-section">
                    <h4>ğŸ¯ Today's Challenge</h4>
                    <div id="daily-challenge" class="daily-challenge">
                        <!-- Challenge will be generated dynamically -->
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Weekly Habits Tab -->
    <div id="weekly-habits-tab" class="tab-content">
        <div class="habits-container">
            <div class="habits-sidebar">
                <h3>Weekly Habits (10 max)</h3>
                <div id="weekly-habits-list" class="habits-list">
                    <!-- Habit names will be added here -->
                </div>
                <button id="add-weekly-habit-btn" class="btn-secondary">+ Add Habit</button>
            </div>

            <div class="habits-grid-container">
                <div id="weekly-habits-grid" class="habits-grid">
                    <!-- Grid will be generated dynamically -->
                </div>
            </div>

            <div class="habits-progress">
                <h3>Monthly Progress</h3>
                <div id="weekly-progress-list" class="progress-list">
                    <!-- Progress items will be added here dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Interval Challenges Tab -->
    <div id="challenges-tab" class="tab-content">
        <div class="challenges-container">
            <header class="challenges-header">
                <h3>Interval Challenges</h3>
                <p class="challenges-description">Track specific habits over a limited time interval (e.g., Ramadhan,
                    30-Day Sprint).</p>
                <button id="start-challenge-btn" class="btn-primary">+ Start New Challenge</button>
            </header>

            <div class="active-challenges-section">
                <h4>Active Challenges</h4>
                <div id="active-challenges-list" class="challenges-grid">
                    <!-- Active challenges will be rendered here -->
                    <div class="empty-state">No active challenges. Start one to begin tracking!</div>
                </div>
            </div>

            <div class="archived-challenges-section">
                <h4>Archived Challenges</h4>
                <div id="archived-challenges-list" class="challenges-list-compact">
                    <!-- Archived challenges will be listed here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Wellness Tab -->
    <div id="wellness-tab" class="tab-content">
        <div class="wellness-container">
            <!-- Mood Tracker -->
            <div class="wellness-section">
                <h3>Mood Tracker</h3>
                <div id="mood-selected-date" class="mood-selected-info">Click a day to select</div>
                <div id="mood-grid" class="mood-grid">
                    <!-- Mood grid will be generated dynamically -->
                </div>
                <div class="mood-selector">
                    <button class="mood-btn" data-mood="ğŸ¥°">ğŸ¥°</button>
                    <button class="mood-btn" data-mood="ğŸ˜">ğŸ˜</button>
                    <button class="mood-btn" data-mood="ğŸ˜¶">ğŸ˜¶</button>
                    <button class="mood-btn" data-mood="ğŸ˜µ">ğŸ˜µ</button>
                    <button class="mood-btn" data-mood="ğŸ˜©">ğŸ˜©</button>
                </div>
                <div id="mood-distribution" class="mood-distribution">
                    <!-- Mood counts will be displayed here -->
                </div>
            </div>

            <!-- Sleep Tracker -->
            <div class="wellness-section">
                <h3>Sleep Tracker</h3>
                <div class="sleep-input-container">
                    <label>
                        Date:
                        <input type="date" id="sleep-date" />
                    </label>
                    <label>
                        Bedtime:
                        <input type="time" id="sleep-bedtime" />
                    </label>
                    <label>
                        Wake Time:
                        <input type="time" id="sleep-wake-time" />
                    </label>
                    <button id="save-sleep-btn" class="btn-primary">Save</button>
                </div>
                <div id="sleep-duration" class="sleep-duration">
                    Duration: <span id="sleep-hours">0</span> hours
                </div>
                <div id="sleep-list" class="sleep-list">
                    <!-- Sleep entries will be listed here -->
                </div>
            </div>

            <!-- Water Tracker -->
            <div class="wellness-section">
                <h3>Water Tracker</h3>
                <div class="water-input-container">
                    <label>
                        Date:
                        <input type="date" id="water-date" />
                    </label>
                    <label>
                        Daily Goal (glasses):
                        <input type="number" id="water-goal" value="8" min="1" max="20" />
                    </label>
                </div>
                <div id="water-counter" class="water-counter">
                    <button id="water-decrease-btn" class="water-btn">-</button>
                    <div class="water-display">
                        <span id="water-glasses">0</span> / <span id="water-goal-display">8</span> glasses
                    </div>
                    <button id="water-increase-btn" class="water-btn">+</button>
                </div>
                <div id="water-percentage" class="water-percentage">
                    Progress: <span id="water-progress">0</span>%
                </div>
                <div id="water-list" class="water-list">
                    <!-- Water entries will be listed here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Habit Item Template -->
<template id="habit-item-template">
    <div class="habit-item" data-habit-id="">
        <div class="habit-item-main">
            <span class="drag-handle" draggable="true" aria-label="Drag to reorder">â‹®â‹®</span>
            <input type="text" class="habit-name" placeholder="Habit name" maxlength="50" />
            <button class="link-goal-btn" aria-label="Link to goal" title="Link to annual goal">ğŸ¯</button>
            <button class="create-card-btn" aria-label="Create card" title="Create Kanban card from habit">ğŸ“‹</button>
            <button class="delete-habit-btn" aria-label="Delete habit">Ã—</button>
        </div>
        <div class="habit-goal-link" style="display: none;">
            <select class="habit-goal-select" aria-label="Select goal to link">
                <option value="">-- Select a goal --</option>
            </select>
        </div>
        <div class="linked-goal-display" style="display: none;">
            <span class="linked-goal-badge">
                <span class="goal-icon">ğŸ¯</span>
                <span class="goal-name"></span>
                <button class="unlink-goal-btn" aria-label="Unlink goal">Ã—</button>
            </span>
        </div>
        <div class="linked-cards-display" style="display: none;">
            <div class="linked-cards-list"></div>
        </div>
    </div>
</template>

<!-- Weekly Habit Item Template -->
<template id="weekly-habit-item-template">
    <div class="habit-item" data-habit-id="">
        <input type="text" class="habit-name" placeholder="Habit name" maxlength="50" />
        <input type="number" class="habit-target" min="1" max="7" value="7" title="Target days per week" />
        <button class="delete-habit-btn" aria-label="Delete habit">Ã—</button>
    </div>
</template>

<!-- Habit Bundles Modal -->
<div id="habit-bundles-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ğŸ“¦ Quick-Start Habit Bundles</h3>
            <button class="modal-close" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
            <p class="modal-description">Add a pre-built set of habits to get started quickly.</p>
            <div class="habit-bundles-grid">
                <div class="habit-bundle-card" data-bundle="morning">
                    <div class="bundle-icon">ğŸŒ…</div>
                    <div class="bundle-info">
                        <h4>Morning Routine</h4>
                        <p>Wake early, Meditate, Exercise, Healthy breakfast, Plan day</p>
                    </div>
                    <button class="btn-primary btn-small">Add</button>
                </div>
                <div class="habit-bundle-card" data-bundle="fitness">
                    <div class="bundle-icon">ğŸ’ª</div>
                    <div class="bundle-info">
                        <h4>Fitness</h4>
                        <p>Workout, 10k steps, Stretch, Drink water, Track calories</p>
                    </div>
                    <button class="btn-primary btn-small">Add</button>
                </div>
                <div class="habit-bundle-card" data-bundle="productivity">
                    <div class="bundle-icon">ğŸš€</div>
                    <div class="bundle-info">
                        <h4>Productivity</h4>
                        <p>Deep work, No social media, Review goals, Learn something, Journal</p>
                    </div>
                    <button class="btn-primary btn-small">Add</button>
                </div>
                <div class="habit-bundle-card" data-bundle="wellness">
                    <div class="bundle-icon">ğŸ§˜</div>
                    <div class="bundle-info">
                        <h4>Wellness</h4>
                        <p>Meditate, Gratitude, Sleep 8hrs, No screens before bed, Self-care</p>
                    </div>
                    <button class="btn-primary btn-small">Add</button>
                </div>
                <div class="habit-bundle-card" data-bundle="learning">
                    <div class="bundle-icon">ğŸ“š</div>
                    <div class="bundle-info">
                        <h4>Learning</h4>
                        <p>Read 30min, Practice skill, Take notes, Review flashcards, Teach someone</p>
                    </div>
                    <button class="btn-primary btn-small">Add</button>
                </div>
                <div class="habit-bundle-card" data-bundle="mindfulness">
                    <div class="bundle-icon">ğŸ§ </div>
                    <div class="bundle-info">
                        <h4>Mindfulness</h4>
                        <p>Morning meditation, Breathing exercises, Mindful eating, Evening reflection, Digital detox
                        </p>
                    </div>
                    <button class="btn-primary btn-small">Add</button>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary modal-close">Close</button>
        </div>
    </div>
</div>

<!-- Challenge Card Template -->
<template id="challenge-card-template">
    <div class="challenge-card" data-challenge-id="">
        <div class="challenge-card-header">
            <div class="challenge-header-title-group">
                <h4 class="challenge-title"></h4>
                <div class="grid-mode-toggle challenge-grid-mode-toggle">
                    <button class="toggle-btn active" data-mode="checklist" title="Checklist View">âœ…</button>
                    <button class="toggle-btn" data-mode="count" title="Count/Note View">ğŸ”¢</button>
                </div>
            </div>
            <div class="challenge-actions">
                <button class="edit-challenge-btn" title="Edit challenge">âœï¸</button>
                <button class="archive-challenge-btn" title="Archive challenge">ğŸ“¥</button>
                <button class="delete-challenge-btn" title="Delete challenge">Ã—</button>
            </div>
        </div>
        <p class="challenge-dates"></p>
        <div class="challenge-progress-bar">
            <div class="progress-fill" style="width: 0%"></div>
        </div>
        <div class="challenge-stats">
            <span class="progress-percent">0%</span>
            <span class="days-remaining"></span>
        </div>
        <div class="challenge-habits-tracking">
            <!-- Tracking grid for challenge habits will be rendered here -->
        </div>
    </div>
</template>

<!-- Start Challenge Modal -->
<div id="start-challenge-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ğŸš€ Start New Interval Challenge</h3>
            <button class="modal-close" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
            <form id="start-challenge-form">
                <div class="form-group">
                    <label for="challenge-title">Challenge Title:</label>
                    <input type="text" id="challenge-title" required placeholder="e.g., Ramadhan 2025, 75 Hard" />
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="challenge-start">Start Date:</label>
                        <input type="date" id="challenge-start" required />
                    </div>
                    <div class="form-group">
                        <label for="challenge-end">End Date:</label>
                        <input type="date" id="challenge-end" required />
                    </div>
                </div>
                <div class="form-group">
                    <label>Specific Habits to Track:</label>
                    <div id="challenge-habits-inputs" class="challenge-habits-inputs"
                        style="max-height: 200px; overflow-y: auto; margin-bottom: 10px; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
                        <div class="challenge-habit-input-row" style="display: flex; gap: 10px; margin-bottom: 5px;">
                            <input type="text" class="challenge-habit-name" placeholder="Habit name (e.g., Fasting)"
                                style="flex: 1;" />
                            <button type="button" class="remove-habit-btn"
                                style="background: none; border: none; color: #ff4d4f; cursor: pointer; font-size: 20px;">Ã—</button>
                        </div>
                    </div>
                    <button type="button" id="add-challenge-habit-row-btn" class="btn-secondary btn-small">+ Add Another
                        Habit</button>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary modal-close">Cancel</button>
            <button type="submit" form="start-challenge-form" class="btn-primary">Start Challenge</button>
        </div>
    </div>
</div>