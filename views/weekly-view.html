<div class="weekly-view" role="region" aria-label="Weekly planning view">
    <!-- Week Selector -->
    <div class="view-header">
        <div class="week-selector" role="group" aria-label="Week navigation">
            <button id="prev-week-btn" class="nav-btn" aria-label="Go to previous week">
                <span aria-hidden="true">‚Üê</span>
            </button>
            <h2 id="current-week-range" aria-live="polite">Week of Jan 1 - Jan 7, 2025</h2>
            <button id="next-week-btn" class="nav-btn" aria-label="Go to next week">
                <span aria-hidden="true">‚Üí</span>
            </button>
            <button id="today-week-btn" class="btn-today" aria-label="Go to current week"
                data-tooltip="Press T">Today</button>
            <button id="add-recurring-btn" class="btn-icon" aria-label="Add recurring time block"
                title="Add recurring blocks">üîÑ</button>
            <button id="save-template-btn" class="btn-icon" aria-label="Save as template"
                title="Save week as template">üíæ</button>
            <button id="load-template-btn" class="btn-icon" aria-label="Load template" title="Load template">üìÇ</button>
            <button id="export-ical-btn" class="btn-icon btn-export" aria-label="Export to calendar"
                title="Export to iCal">üì§</button>
        </div>
    </div>

    <div class="weekly-content">
        <!-- Left Sidebar -->
        <div class="sidebar-section">
            <!-- Weekly Summary -->
            <div class="weekly-summary" id="weekly-summary">
                <h3>Week at a Glance</h3>
                <div class="summary-stats">
                    <div class="summary-stat">
                        <span class="summary-stat-value" id="goals-completed">0/0</span>
                        <span class="summary-stat-label">Goals Done</span>
                    </div>
                    <div class="summary-stat">
                        <span class="summary-stat-value" id="time-blocks-count">0</span>
                        <span class="summary-stat-label">Time Blocks</span>
                    </div>
                    <div class="summary-stat">
                        <span class="summary-stat-value" id="scheduled-hours">0h</span>
                        <span class="summary-stat-label">Scheduled</span>
                    </div>
                </div>
                <div id="week-comparison" class="week-comparison" style="display: none;">
                    <span class="comparison-text"></span>
                </div>
                <div id="productivity-score" class="productivity-score" style="display: none;">
                    <div class="score-ring">
                        <svg viewBox="0 0 36 36" class="circular-chart">
                            <path class="circle-bg"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                            <path class="circle" stroke-dasharray="0, 100"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                            <text x="18" y="20.35" class="score-text">0%</text>
                        </svg>
                    </div>
                    <span class="score-label">Productivity</span>
                </div>
                <div id="best-day-analysis" class="best-day-analysis" style="display: none;">
                    <span class="best-day-icon">üèÜ</span>
                    <span class="best-day-text">Best day: <strong id="best-day-name">-</strong></span>
                    <span class="best-day-count" id="best-day-count"></span>
                </div>
                <button id="ai-weekly-insights-btn" class="ai-insights-btn" title="Get AI-powered weekly insights">
                    ‚ú® AI Insights
                </button>
            </div>

            <!-- Weekly Goals -->
            <div class="weekly-goals">
                <h3>Weekly Goals</h3>
                <div id="weekly-goals-container" class="weekly-goals-container">
                    <!-- Weekly goals will be dynamically added here -->
                </div>
                <button id="add-weekly-goal-btn" class="btn-secondary">+ Add Goal</button>
            </div>

            <!-- Color Category Legend -->
            <div class="category-legend">
                <div class="category-legend-header">
                    <h3>Categories</h3>
                    <div class="category-legend-actions">
                        <button id="clear-filter-btn" class="btn-icon btn-clear-filter" aria-label="Clear filter"
                            title="Clear filter" style="display: none;">‚úï</button>
                        <button id="manage-categories-btn" class="btn-icon" aria-label="Manage categories"
                            title="Manage categories">‚öôÔ∏è</button>
                    </div>
                </div>
                <p class="category-hint">Click a category to filter</p>
                <div class="category-list" id="category-list">
                    <!-- Categories will be dynamically loaded here -->
                </div>
            </div>
        </div>

        <!-- Main Schedule Grid -->
        <div class="schedule-section">
            <div class="schedule-grid">
                <!-- Day Headers -->
                <div class="schedule-header">
                    <div class="time-column-header"></div>
                    <div class="day-header" data-day="1">
                        <div class="day-name">Monday</div>
                        <div class="day-date"></div>
                    </div>
                    <div class="day-header" data-day="2">
                        <div class="day-name">Tuesday</div>
                        <div class="day-date"></div>
                    </div>
                    <div class="day-header" data-day="3">
                        <div class="day-name">Wednesday</div>
                        <div class="day-date"></div>
                    </div>
                    <div class="day-header" data-day="4">
                        <div class="day-name">Thursday</div>
                        <div class="day-date"></div>
                    </div>
                    <div class="day-header" data-day="5">
                        <div class="day-name">Friday</div>
                        <div class="day-date"></div>
                    </div>
                    <div class="day-header" data-day="6">
                        <div class="day-name">Saturday</div>
                        <div class="day-date"></div>
                    </div>
                    <div class="day-header" data-day="0">
                        <div class="day-name">Sunday</div>
                        <div class="day-date"></div>
                    </div>
                </div>

                <!-- Time Slots Grid -->
                <div id="time-slots-grid" class="time-slots-grid">
                    <!-- Time slots will be dynamically generated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Sections (Expandable) -->
    <div class="daily-sections">
        <h3>Daily Details</h3>
        <div id="daily-sections-container" class="daily-sections-container">
            <!-- Daily sections for each day will be dynamically added here -->
        </div>
    </div>
</div>

<!-- Weekly Goal Template -->
<template id="weekly-goal-template">
    <div class="weekly-goal-item" data-goal-id="">
        <div class="goal-priority-indicator"></div>
        <input type="checkbox" class="goal-checkbox" />
        <input type="text" class="goal-text" placeholder="Goal description" />
        <select class="goal-priority">
            <option value="Urgent">Urgent</option>
            <option value="Medium">Medium</option>
            <option value="Low">Low</option>
        </select>
        <button class="delete-goal-btn" aria-label="Delete goal">√ó</button>
    </div>
</template>

<!-- Time Block Template -->
<template id="time-block-template">
    <div class="time-block" data-block-id="" draggable="true">
        <div class="time-block-content">
            <div class="time-block-time"></div>
            <div class="time-block-activity"></div>
        </div>
        <div class="time-block-resize-handle"></div>
    </div>
</template>

<!-- Daily Section Template -->
<template id="daily-section-template">
    <div class="daily-section" data-date="">
        <div class="daily-section-header">
            <h4 class="daily-section-date"></h4>
            <button class="toggle-daily-section">‚ñº</button>
        </div>
        <div class="daily-section-content">
            <!-- Checklist -->
            <div class="daily-checklist">
                <h5>Checklist</h5>
                <div class="checklist-items"></div>
                <button class="add-checklist-item-btn">+ Add Item</button>
            </div>

            <!-- Kanban Tasks -->
            <div class="daily-kanban">
                <h5>Kanban Tasks</h5>
                <div class="kanban-items"></div>
            </div>

            <!-- Mini Journal -->
            <div class="daily-journal">
                <h5>Journal</h5>
                <textarea class="journal-text" placeholder="What happened today?" rows="3"></textarea>
            </div>

            <!-- Gratitude -->
            <div class="daily-gratitude">
                <h5>Gratitude</h5>
                <textarea class="gratitude-text" placeholder="What are you grateful for?" rows="2"></textarea>
            </div>
        </div>
    </div>
</template>

<!-- Checklist Item Template -->
<template id="checklist-item-template">
    <div class="checklist-item">
        <input type="checkbox" class="checklist-checkbox" />
        <input type="text" class="checklist-text" placeholder="Task" />
        <button class="delete-checklist-btn" aria-label="Delete">√ó</button>
    </div>
</template>

<!-- Time Block Editor Modal -->
<div id="time-block-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-title">Add Time Block</h3>
            <button class="modal-close" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="block-date">Date</label>
                <input type="date" id="block-date" required />
            </div>
            <div class="form-group">
                <label>Event Type</label>
                <div class="event-type-selector">
                    <label class="event-type-option">
                        <input type="radio" name="weekly-event-type" value="time-block" checked />
                        <span class="event-type-label">
                            <span class="event-type-icon">‚è∞</span>
                            <span class="event-type-text">
                                <strong>Time Block</strong>
                                <small>Scheduled activity</small>
                            </span>
                        </span>
                    </label>
                    <label class="event-type-option">
                        <input type="radio" name="weekly-event-type" value="kanban-card" />
                        <span class="event-type-label">
                            <span class="event-type-icon">üìã</span>
                            <span class="event-type-text">
                                <strong>Kanban Card</strong>
                                <small>Add to board</small>
                            </span>
                        </span>
                    </label>
                </div>
            </div>
            <div class="form-group">
                <label for="block-start-time">Start Time</label>
                <input type="time" id="block-start-time" step="1800" required />
                <div class="minute-shortcuts" data-target="block-start-time">
                    <button type="button" class="btn-minute" data-minute="00">:00</button>
                    <button type="button" class="btn-minute" data-minute="15">:15</button>
                    <button type="button" class="btn-minute" data-minute="30">:30</button>
                    <button type="button" class="btn-minute" data-minute="45">:45</button>
                </div>
            </div>
            <div class="form-group">
                <label for="block-end-time">End Time</label>
                <input type="time" id="block-end-time" step="1800" />
                <div class="minute-shortcuts" data-target="block-end-time">
                    <button type="button" class="btn-minute" data-minute="00">:00</button>
                    <button type="button" class="btn-minute" data-minute="15">:15</button>
                    <button type="button" class="btn-minute" data-minute="30">:30</button>
                    <button type="button" class="btn-minute" data-minute="45">:45</button>
                </div>
            </div>
            <div class="form-group">
                <label for="block-activity">Activity</label>
                <div class="activity-input-group">
                    <input type="text" id="block-activity" placeholder="Activity description" required />
                    <button type="button" id="ai-categorize-btn" class="btn-icon ai-categorize-btn"
                        title="Auto-categorize with AI">‚ú®</button>
                </div>
            </div>
            <div class="form-group">
                <label for="block-category">Category</label>
                <select id="block-category">
                    <!-- Categories will be dynamically loaded -->
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button id="save-time-block-btn" class="btn-primary">Save</button>
            <button id="duplicate-time-block-btn" class="btn-secondary" style="display: none;">Duplicate</button>
            <button id="delete-time-block-btn" class="btn-danger" style="display: none;">Delete</button>
            <button class="btn-secondary modal-close">Cancel</button>
        </div>
    </div>
</div>

<!-- Category Manager Modal -->
<div id="category-manager-modal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3>Manage Categories</h3>
            <button class="modal-close" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
            <div id="category-manager-list" class="category-manager-list">
                <!-- Category items will be dynamically loaded -->
            </div>
            <button id="add-category-btn" class="btn-secondary">+ Add New Category</button>
        </div>
        <div class="modal-footer">
            <button class="btn-primary modal-close">Done</button>
        </div>
    </div>
</div>

<!-- Category Item Template for Manager -->
<template id="category-manager-item-template">
    <div class="category-manager-item" data-category-id="">
        <div class="category-manager-color-preview"></div>
        <input type="text" class="category-manager-name" placeholder="Category name" />
        <div class="category-manager-colors">
            <input type="color" class="category-color-start" title="Start color" />
            <span>‚Üí</span>
            <input type="color" class="category-color-end" title="End color" />
        </div>
        <button class="delete-category-btn" aria-label="Delete category">√ó</button>
    </div>
</template>

<!-- Save Template Modal -->
<div id="save-template-modal" class="modal" style="display: none;">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h3>Save as Template</h3>
            <button class="modal-close" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
            <p class="modal-description">Save your current week's schedule as a reusable template.</p>
            <div class="form-group">
                <label for="template-name">Template Name</label>
                <input type="text" id="template-name" placeholder="e.g., Work Week, Study Schedule" required />
            </div>
        </div>
        <div class="modal-footer">
            <button id="confirm-save-template-btn" class="btn-primary">Save Template</button>
            <button class="btn-secondary modal-close">Cancel</button>
        </div>
    </div>
</div>

<!-- Load Template Modal -->
<div id="load-template-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Load Template</h3>
            <button class="modal-close" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
            <p class="modal-description">Apply a saved template to the current week.</p>
            <div id="template-list" class="template-list">
                <!-- Templates will be loaded here -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary modal-close">Close</button>
        </div>
    </div>
</div>

<!-- Recurring Time Block Modal -->
<div id="recurring-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Recurring Time Blocks</h3>
            <button class="modal-close" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="recurring-activity">Activity</label>
                <input type="text" id="recurring-activity" placeholder="Activity description" required />
            </div>
            <div class="form-group">
                <label for="recurring-category">Category</label>
                <select id="recurring-category">
                    <!-- Categories will be dynamically loaded -->
                </select>
            </div>
            <div class="form-group">
                <label for="recurring-start-time">Start Time</label>
                <input type="time" id="recurring-start-time" step="1800" required />
            </div>
            <div class="form-group">
                <label for="recurring-end-time">End Time</label>
                <input type="time" id="recurring-end-time" step="1800" />
            </div>
            <div class="form-group">
                <label>Days of the Week</label>
                <div class="recurring-days-grid">
                    <label class="recurring-day-label">
                        <input type="checkbox" class="recurring-day-checkbox" value="0" />
                        <span>Mon</span>
                    </label>
                    <label class="recurring-day-label">
                        <input type="checkbox" class="recurring-day-checkbox" value="1" />
                        <span>Tue</span>
                    </label>
                    <label class="recurring-day-label">
                        <input type="checkbox" class="recurring-day-checkbox" value="2" />
                        <span>Wed</span>
                    </label>
                    <label class="recurring-day-label">
                        <input type="checkbox" class="recurring-day-checkbox" value="3" />
                        <span>Thu</span>
                    </label>
                    <label class="recurring-day-label">
                        <input type="checkbox" class="recurring-day-checkbox" value="4" />
                        <span>Fri</span>
                    </label>
                    <label class="recurring-day-label">
                        <input type="checkbox" class="recurring-day-checkbox" value="5" />
                        <span>Sat</span>
                    </label>
                    <label class="recurring-day-label">
                        <input type="checkbox" class="recurring-day-checkbox" value="6" />
                        <span>Sun</span>
                    </label>
                </div>
            </div>
            <div class="recurring-quick-select">
                <button type="button" class="btn-small"
                    onclick="document.querySelectorAll('.recurring-day-checkbox').forEach((cb,i) => cb.checked = i < 5)">Weekdays</button>
                <button type="button" class="btn-small"
                    onclick="document.querySelectorAll('.recurring-day-checkbox').forEach((cb,i) => cb.checked = i >= 5)">Weekend</button>
                <button type="button" class="btn-small"
                    onclick="document.querySelectorAll('.recurring-day-checkbox').forEach(cb => cb.checked = true)">All
                    Days</button>
            </div>
        </div>
        <div class="modal-footer">
            <button id="save-recurring-btn" class="btn-primary">Create Blocks</button>
            <button class="btn-secondary modal-close">Cancel</button>
        </div>
    </div>
</div>